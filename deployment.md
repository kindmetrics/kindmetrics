# Deployment
You can easily deploy this. Just clone this to your computer and run `docker build .` and deploy that container to your server. Kindmetrics use all lucky framework environment variables which can be seen here: https://luckyframework.org/guides/deploying/ubuntu#creating-a-systemd-unit-file-for-your-app

Kindmetrics is dependent on some SMTP mail server and postgresql. Be sure to have those prepared.

## Docker hub - download the prebuilt one
We have an docker container published at docker hub: https://hub.docker.com/repository/docker/kindmetrics/kindmetrics

You should be able to run `docker pull kindmetrics/kindmetrics:latest` to get the latest build there.

## Requirement
You would need this to run:
* docker
* postgres
* clickhouse

Kindmetrics is running its instance on Kubernetes, you can find example how to set that up in `/script/kube`

## Want to uglify the track.js file?
To simplify and make it more straightforward Kindmetrics for self-hosting will return an non-uglify track.js file as default. Making it easy to change host later.

If you want to uglify the track.js file for your host. You have to set `APP_HOST` to the host the api endpoint. After that you can do one of two ways:

1. run `yarn prod` on docker run before running the server. You might need to install yarn on every run and this is not recommended.
2. rebuild docker container with your own version with `APP_HOST` set. It will generate the track.js under `/public` directory - you should be able to get it from there if  you want to host it on a CDN or similar.

2 is how we do for kindmetrics hosted version.

If you don't want to do anything and just want it to load the uglified track.js file, you can tell track action to get the public file by setting `TRACK_PUBLIC` to 1.

## Environment variables

### LUCKY_ENV
Should be `production`

### APP_DOMAIN
this is the URL to the site the server is having.
example: `https://kindmetrics.io`

### APP_HOST
should only be the hostname, `app.kindmetrics.io` as an example.
This is used for redirects if the host is not correct, good if other domains are pointing at the same ip address. If used on localhost, write `localhost` here.

### APP_TRACK_HOST
the host for the track, if you use cdn or another static hosting for the track javascript. if you don't, just set this as the same as `APP_HOST` or like we have done, on our landing page. Like `kindmetrics.io`

### TRACK_PUBLIC
This tell the tracker action to just get the public track.js file - it will not set url for you or anything. This is when you have generated your own track.js file that is under `./public` directory.

### DATABASE_URL
The database URL to the db.
usually starts with `postgres://` for postgres.

### HOST
the host to the server, example `0.0.0.0`

### PORT
the port it shall listen to, should be `5000` usually

### SECRET_KEY_BASE
A generated secret key base to handle the secrets. Can be generated by lucky or others. NEED TO BE SET

### SMTP_HOST
DNS or IP to the SMTP server to send emails to

### SMTP_PASSWORD
password for smtp

### SMTP_USERNAME
username for smtp

### EMAIL_FROM
email where confirmation email and all that will be sent from, like `hakan@kindmetrics.io` - pick same domain you have right to send from through the smtp above.

### EMAIL_FROM_NAME
The name of the email for confirmation email, like `Håkan Nylén` or `Kindmetrics`
